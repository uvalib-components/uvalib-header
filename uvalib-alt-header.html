<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../app-layout/app-header/app-header.html">
<link rel="import" href="../app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../app-layout/app-scroll-effects/effects/resize-snapped-title.html">
<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-item.html">

<link rel="import" href="../uva-brand-style/uva-layout-behavior.html">

<!--
`uvalib-alt-header`
UVA Library Page Header for Alternate Library sites

@demo demo/alt.html
-->

<dom-module id="uvalib-alt-header">
  <template>
    <style is="custom-style" include="uvalib-theme">
      :host {
        display: block;
        margin: 0;
        z-index: 1000;
      }
    </style>

    <iron-media-query query="{{smallScreenQuery}}" query-matches="{{smallScreen}}"></iron-media-query>
    <iron-media-query query="{{mediumScreenQuery}}" query-matches="{{mediumScreen}}"></iron-media-query>
    <iron-media-query query="{{largeScreenQuery}}" query-matches="{{largeScreen}}"></iron-media-query>

    <app-header id="header" shadow condenses fixed effects="blend-background parallax-background resize-snapped-title">
      <app-toolbar></app-toolbar>
      <app-toolbar></app-toolbar>
      <app-toolbar></app-toolbar>
      <app-toolbar></app-toolbar>
      <app-toolbar></app-toolbar>
      <app-toolbar>
        <div title spacer>
          <div main>{{title}}</div>
          <div sub>{{subTitle}}&mdash;{{_issue.title}}</div>
        </div>
      </app-toolbar>
      <app-toolbar></app-toolbar>
      <app-toolbar bottom>
        <template is="dom-if" if="[[smallScreen]]">
          <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
        </template>
        <div condensed-title><a href="/news/{{_issue.slug}}">{{title}}&mdash;{{_issue.title}}</a></div>
        <template is="dom-if" if="[[!smallScreen]]">
          <a href="/news/{{_issue.slug}}">Home</a>
          <template is="dom-if" if="{{_multiple(_issueSlugs)}}">
            <paper-menu-button>
              <paper-button class="dropdown-trigger">
                <span>Archive</span>
              </paper-button>
              <paper-menu class="dropdown-content" attr-for-selected="slug" selected="{{issueData.issue}}">
                <template is="dom-repeat" items="{{_issueSlugs}}">
                  <paper-item slug="{{item.slug}}">{{item.title}}</paper-item>
                </template>
              </paper-menu>
            </paper-menu-button>
          </template>
          <template is="dom-if" if="{{mailchimpId}}">
            <a href="/subscribe">Subscribe</a>
          </template>
        </template>
      </app-toolbar>
    </app-header>
  </template>

  <script>
    Polymer({

      is: 'uvalib-alt-header',
      behaviors: [uvabehaviors.layout],
      properties: {
        /**
         * Array of JSON items that represent the navigation. Each JSON item has a label property, an icon property, and a url property.
         */
        navigation: {
          type: Array,
          value: [
            {"label": "About", "icon": "university", "url": "//www.library.virginia.edu/about-uva-library/"},
            {"label": "Research", "icon": "graduation-cap", "url": "//www.library.virginia.edu/research/"},
            {"label": "Collections", "icon": "book", "url": "//www.library.virginia.edu/collections/"},
            {"label": "Services", "icon": "cloud", "url": "//www.library.virginia.edu/services/"}
          ],
        },
        smallScreen: {
          type: Boolean,
          notify: true,
          value: false,
          reflectToAttribute: true
        },
        mediumScreen: {
          type: Boolean,
          notify: true,
          value: false,
          reflectToAttribute: true
        },
        largeScreen: {
          type: Boolean,
          notify: true,
          value: false,
          reflectToAttribute: true
        },
        contentHasSearchBox: {
          type: Boolean,
          value: false
        },
        _showSearch: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        _searchInView: {
          type: Boolean,
          value: true,
          notify: true
        }
      },

      openDrawer: function(ev) {
        this.fire('open-drawer');
        console.log('open drawer');
      },

      showSearch: function(ev) {
        this._showSearch = (this._showSearch) ? false : true;
      },

      openHours: function(ev){
        this.$.hours.positionTarget = ev.target;
        this.$.hours.open();
      },
      closeHours: function(){
        this.$.hours.close();
      },
      _searchSignal: function(e, searchInView, sender){
        this._searchInView = searchInView;
      },
      _showSearchToolItem: function(inView, large) {
        return inView || !large;
      },
      _triggerSearch: function(){
        this.fire('iron-signal', {name: "triggersearch"});
      },
      _hoursDropdownHalign: function(largeScreen){
        if (largeScreen) return "right";
        else return "left";
      },
      ready: function(){
        setTimeout(function(){
          console.log('header hack until https://github.com/PolymerElements/app-layout/issues/320 is resolved');
          this.$.header.resetLayout();
        }.bind(this),500);
      }
    });
  </script>
</dom-module>
