<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-signals/iron-signals.html" >
<link rel="import" href="../iron-dropdown/iron-dropdown.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../app-layout/app-header/app-header.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="../uvalib-button/uvalib-button.html">
<link rel="import" href="../uvalib-logos/uvalib-logo.html">
<link rel="import" href="../uvalib-nav/uvalib-nav.html">
<link rel="import" href="../uvalib-search-box/uvalib-search-box.html" >
<link rel="import" href="../uvalib-card/uvalib-hours-card.html" >

<!--
`uvalib-header`
UVA Library Page Header

@demo demo/index.html
-->

<dom-module id="uvalib-header">
  <template>
    <style is="custom-style" include="uvalib-theme">
      :host {
        display: block;
        margin: 0;
        height: 104px;
      }
      :host([searchframe]){
        height: 234px;
      }
      :host([small-screen]){
        height: 86px;
      }

      /* app header wraps everything */
      app-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 104px;
        z-index: 999999999999;
      }
      app-header[searchframe] {
        height: 234px;
      }

      app-header.small {
        height: 86px;
      }

      /* top area of the header */
      #top {
        @apply(--layout-vertical);
        @apply(--layout-center);
        height: 64px;
        background-color: #002f6c;
      }
      [searchframe] #top {
        height: 194px;
      }

      .small #top {
        height: 86px;
      }

      .searchbar {
        height: 50px;
        background-color: white;
      }

      #searchframe {
        height: 130px;
        background-color: white;
        width: 105%;
        overflow: hidden;
        z-index: 1;
      }

      .toolbar {
        width: 100%;
        @apply(--layout-flex);
        max-width: var(--uvalib-display-width-max);
        padding: 0 128px 0 128px;
        z-index: 2;
      }

      .large .toolbar {
        @apply(--layout-center);
        @apply(--layout-horizontal);
      }

      .medium .toolbar {
        @apply(--layout-center);
        @apply(--layout-horizontal);
        padding: 0 16px 0 16px;
      }

      .small .toolbar {
        padding: 0 10px 0 10px;
        @apply(--layout-vertical);
      }

      .small .toolbar div {
        @apply(--layout-center);
        @apply(--layout-horizontal);
      }

      .small .toolbar div .logo {
        padding-top: 5px;
      }

      .small .toolbar div .links {
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-justified);
      }

      .small .toolbar paper-icon-button {
        color: var(--color-white);
      }

      .small .toolbar uvalib-search-box {
        @apply(--layout-flex);
      }

      .toolbar uvalib-button {
        padding: 0 10px 0 10px;
        --uvalib-button: {
          font-family: var(--font-primary);
          font-size: 14px;
          font-weight: bold;
          font-style: normal;
          font-stretch: normal;
          line-height: 1.14;
          letter-spacing: 1px;
          text-transform: none;
        };
        color: var(--color-white);
        --uvalib-button-icon-width: 12px;
        --uvalib-button-icon-height: 12px;
      }

      /* logo constraints */
      .medium .logo, .large .logo {
        @apply(--layout-flex);
      }

      #search {
        color: #fd7d1c;
      }

      uvalib-logo {
        width: 325px;
      }
      uvalib-logo[short-form] {
        width: 100px;
      }
      uvalib-logo[rotunda-only] {
        width: 17px;
      }

      #bottom {
        height: 40px;
        background-color: #00224d;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

      #bottom nav {
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-end-justified);
        max-width: var(--uvalib-display-width-max);
      }

      #bottom nav a {
        font-size: 18px;
        font-weight: 600;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: 1.3px;
        color: #ffffff;
        margin-left: 70px;
      }

      .dropdown-content {
        background-color: white;
        line-height: 20px;
        border-radius: 3px;
        box-shadow: 0px 2px 6px #ccc;
      }
      uvalib-hours-card[all-locations] {
        height: 1024px;
      }


      #top, #bottom {
        padding-left: 10px;
        padding-right: 10px;
      }

      [hidden] {
        display: none;
      }

      uvalib-hours-card uvalib-button {
        color: #000000 !important;
      }

      .lower uvalib-button {
        --uvalib-button-bkgrd-color: #00224d;
        --uvalib-button: {
          text-transform: uppercase;
        }
      }

      #bottom[hidden] {
        display: none !important;
      }
    </style>

    <app-header id="appheader" searchframe$="[[searchframe]]" fixed condenses reveals effects="waterfall" class$="[[_screenSize(smallScreen, mediumScreen, largeScreen)]]">
      <div id="top">
        <div id="searchframe" class$="[[_screenReaderSearchFrame(searchframe)]]">
          <uvalib-search-area id="searchbox" small$="[[mediumScreen]]" advanced-search site-search on-close="_closeSearch"></uvalib-search-area>
        </div>
        <iron-dropdown style="display:none" id="hours" dynamic-align>
          <div class="dropdown-content">
            <uvalib-hours-card close-icon all-locations elevation="0" on-close="closeHours">
              <uvalib-button class="fullhoursbutton" href="http://cal.lib.virginia.edu/hours/">View all hours</uvalib-button>
            </uvalib-hours-card>
          </div>
        </iron-dropdown>
        <div class="toolbar">
          <template is="dom-if" if="[[!smallScreen]]">
            <div class="logo">
              <a href="/"><uvalib-logo main-title reverse two-color short-form$="[[mediumScreen]]"></uvalib-logo></a>
            </div>
            <!--<uvalib-button id="search" icon="search" on-tap="_triggerSearch" hidden$="{{b}}">Search</uvalib-button>-->
            <uvalib-search-box use-icon-for-button on-focus="_triggerSearch" hidden$="[[searchframe]]"></uvalib-search-box>

            <uvalib-button href="http://www.library.virginia.edu/askalibrarian/">Ask a Librarian</uvalib-button>
            <uvalib-button icon="angle-down" reverse on-tap="openHours">Hours</uvalib-button>

            <uvalib-button href="http://search.lib.virginia.edu/account/review">Sign In</uvalib-button>
          </template>
          <template is="dom-if" if="[[smallScreen]]">
            <div class="upper">
              <div class="logo">
                <uvalib-logo main-title reverse two-color rotunda-only></uvalib-logo>
              </div>
              <div class="links">
                <uvalib-button icon="angle-down" reverse on-tap="openHours">Hours</uvalib-button>

                <uvalib-button href="http://www.library.virginia.edu/askalibrarian/">Ask a Librarian</uvalib-button>
                <uvalib-button href="http://search.lib.virginia.edu/account/review">Sign In</uvalib-button>
              </div>
            </div>
            <div class="lower">
              <!--<paper-icon-button icon="bars" on-tap="openDrawer"></paper-icon-button>-->
              <uvalib-button class="menubutton" raised on-tap="_openDrawer">Menu</uvalib-button>
              <uvalib-search-box use-icon-for-button></uvalib-search-box>
            </div>
          </template>
        </div>
      </div>

      <div id="bottom" sticky hidden$="[[smallScreen]]">

        <nav>
          <template is="dom-repeat" items="[[navigation]]">
            <a href="[[item.url]]">[[item.label]]</a>
          </template>
        </nav>

      </div>
    </app-header>

  </template>

  <script>
    Polymer({
      is: 'uvalib-header',
      properties: {
        /**
         * Array of JSON items that represent the navigation. Each JSON item has a label property, an icon property, and a url property.
         */
        navigation: {
          type: Array,
          value: [
            {"label": "About", "icon": "university", "url": "http://www.library.virginia.edu/about-uva-library/"},
            {"label": "Research", "icon": "graduation-cap", "url": "http://www.library.virginia.edu/research/"},
            {"label": "Collections", "icon": "book", "url": "http://www.library.virginia.edu/collections/"},
            {"label": "Services", "icon": "cloud", "url": "http://www.library.virginia.edu/services/"}
          ],
        },
        searchOpen: {
          type:Boolean,
          reflectToAttribute: true,
          notify: true
        },
        smallScreen: {
          type:Boolean,
          value:false
        },
        mediumScreen: {
          type: Boolean,
          value: false
        },
        largeScreen: {
          type: Boolean,
          value: true
        },
        searchframe: {
          type: Boolean,
          value: false,
          reflectToAttribute: true,
          observer: '_resetHeaderLayout'
        },
      },
      _openDrawer: function(ev) {
        this.fire('open-drawer');
        console.log('open drawer');
      },
      openSearch: function(){
        this.searchOpen = true;
      },
      openHours: function(ev){
        var hours = this.$.appheader.querySelector('#hours');
        hours.positionTarget = ev.target;
        hours.open();
      },
      closeHours: function(){
        this.$.appheader.querySelector('#hours').close();
      },
      _screenReaderSearchFrame: function(value) {
        if (value) {
          return "";
        } else {
          return "screen-reader-text";
        }
      },
      _resetHeaderLayout: function(){
        this.$.appheader.resetLayout();
        setTimeout(function(){this.$.appheader.scroll(0,0)}.bind(this), 50);
      },
      _screenSize: function(smallScreen, mediumScreen, largeScreen){
        var size = (smallScreen)? "small":
                              (mediumScreen)? "medium":
                                              "large";
        console.log(size);
        return size;
      },
      _triggerSearch: function(){
        console.log('search has been triggered');
        if (!this.searchframe) {
          this.searchframe = true;
          this.$.searchbox.focus();
        }
      },
      _closeSearch: function(){
        if (this.searchframe) this.searchframe = false;
      },
      _hoursDropdownHalign: function(largeScreen){
        if (largeScreen) return "right";
        else return "left";
      },
    });
  </script>
</dom-module>
