<link rel="import" href="../uvalib-theme/uvalib-ui-element.html">
<link rel="import" href="../uva-helper-libs/polyfills/object.assign.html">
<link rel="import" href="../uvalib-logos/uvalib-logos.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-badge/paper-badge.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="../uvalib-theme/uvalib-icons.html">
<link rel="import" href="../uvalib-theme/uvalib-header-style.html">
<link rel="import" href="../uvalib-alerts/uvalib-alerts.html">
<link rel="import" href="../iron-meta/iron-meta.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">


<dom-module id="uvalib-simple-header">
  <template>
    <custom-style>
      <style include="uvalib-theme uvalib-header-style iron-flex">
        [hide] paper-badge {
          opacity: 0;
        }
        [hide] iron-icon {
          opacity: .5;
        }
        #top #menu {
          display: inline-block;
        }
        :host([small-screen]) #spacer {
          display: none;
        }
      </style>
    </custom-style>
    <div id="header" class="layout center justified" role="banner">
      <div id="top">
        <div style="width: 100%;">
          <div id="logo">
            <a href="//library.virginia.edu/"><uvalib-logos stacked$=[[smallScreen]] two-color reverse></uvalib-logos></a>
          </div>
          <div id="spacer" class="flex"></div>
          <div id="menu">
            <nav>
              <ul>
                <li>
                  <a href="//library.virginia.edu/askalibrarian"><iron-icon  class="largeScreen" icon="comments"></iron-icon> Ask a Librarian</a>
                </li>
                <li>
                  <div style="position: relative; display: inline-block" hide$="[[!_larger(_alertSeenCount,0)]]">
                    <a href="" id="alert" on-click="viewAllAlerts" aria-label="Alerts">
                      <iron-icon icon="bell" alt="Library Alerts"></iron-icon>
                      <paper-badge id="alertBadge" for="alert" label="[[_alertSeenCount]]"></paper-badge>
                    </a>
                  </div>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
      <uvalib-alerts id="alerts" seen-count="{{_alertSeenCount}}" on-size-changed="_adjustHeight"></uvalib-alerts>
    </div>
    <iron-meta key="uvalib-header-height" value="{{_height}}"></iron-meta>
  </template>

  <script>

    /**
     * `uvalib-simple-header`
     * Header element for the UVA Library web apps
     *
     * ### Styling
     *
     * `<uvalib-simple-header>` provides the following custom properties and mixins for styling:
     *
     * Custom property | Description | Default
     * ----------------|-------------|----------
     * `--uvalib-header-background-color` | Background color of the header element | '--color-primary-color'
     * `--uvalib-header-nav-background-color` | Background color of the header nav section (for large screens) | `--color-secondary-blue`
     *
     * @customElement
     * @polymer
     * @demo demo/simple.html
     */
    class UvalibSimpleHeader extends UvalibUiElement {
      static get is() { return 'uvalib-simple-header'; }
      static get properties() {
        return Object.assign(super.properties,
            {
              lite: {
                type: Boolean,
                value: true
              },
              /** Tracks the header components height **/
              _height: {
                type: String,
                notify: true
              },
              _alertSeenCount: {
                type: Number,
                observer: '_seenCountChanged'
              },
              tabindex: {
                type: Number,
                value: -1
              }
            });
      }
      //Concat the this elements template with the parents
      static get template() {
        var parentTemplate = UvalibUiElement.template.cloneNode(true);
        var childTemplate = Polymer.DomModule.import('uvalib-simple-header', 'template');
        parentTemplate.content.insertBefore(childTemplate.content,null);
        return parentTemplate;
      }
      connectedCallback() {
        super.connectedCallback();
        this._adjustHeight();
      }
      _adjustHeight() {
        this.style.height=this.$.header.clientHeight+"px";
      }
      _seenCountChanged(){
        this.$.alertBadge.notifyResize();
      }
      viewAllAlerts(e){
        e.preventDefault();
        this.$.alerts.unseeAll();
      }
      changeFocusToFirstItem() {
        this.$.logo.querySelector('a').focus();
      }
    }

    window.customElements.define(UvalibSimpleHeader.is, UvalibSimpleHeader);
  </script>
</dom-module>
